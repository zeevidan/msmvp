{"version":3,"sources":["../src/hooks/useTableCompositeNavigation.ts"],"sourcesContent":["import * as React from 'react';\nimport { useFluent_unstable as useFluent } from '@fluentui/react-shared-contexts';\nimport { ArrowDown, ArrowRight, ArrowUp } from '@fluentui/keyboard-keys';\nimport {\n  useArrowNavigationGroup,\n  useFocusableGroup,\n  useMergedTabsterAttributes_unstable,\n  TabsterDOMAttribute,\n  useFocusFinders,\n  GroupperMoveFocusEvent,\n  MoverMoveFocusEvent,\n  GroupperMoveFocusActions,\n  MoverKeys,\n} from '@fluentui/react-tabster';\nimport { isHTMLElement } from '@fluentui/react-utilities';\n\nexport function useTableCompositeNavigation(): {\n  onTableKeyDown: React.KeyboardEventHandler;\n  tableTabsterAttribute: TabsterDOMAttribute;\n  tableRowTabsterAttribute: TabsterDOMAttribute;\n} {\n  const horizontalAttr = useArrowNavigationGroup({ axis: 'horizontal' });\n  const gridAttr = useArrowNavigationGroup({ axis: 'grid' });\n  const groupperAttr = useFocusableGroup({ tabBehavior: 'limited-trap-focus' });\n  const { findFirstFocusable } = useFocusFinders();\n  const { targetDocument } = useFluent();\n\n  const rowAttr = useMergedTabsterAttributes_unstable(horizontalAttr, groupperAttr);\n\n  const onKeyDown: React.KeyboardEventHandler = React.useCallback(\n    e => {\n      if (!targetDocument) {\n        return;\n      }\n\n      let activeElement = targetDocument.activeElement;\n      if (!activeElement || !e.currentTarget.contains(activeElement)) {\n        return;\n      }\n      const activeElementRole = activeElement.getAttribute('role');\n\n      // Enter groupper when in row focus mode to navigate cells\n      if (e.key === ArrowRight && activeElementRole === 'row' && isHTMLElement(activeElement)) {\n        findFirstFocusable(activeElement)?.focus();\n      }\n\n      if (activeElementRole === 'row') {\n        return;\n      }\n\n      const isInCell = (() => {\n        let cur = isHTMLElement(activeElement) ? activeElement : null;\n        while (cur) {\n          const curRole = cur.getAttribute('role');\n          if (curRole === 'cell' || curRole === 'gridcell') {\n            return true;\n          }\n\n          cur = cur.parentElement;\n        }\n\n        return false;\n      })();\n\n      // Escape groupper focus trap before arrow down\n      if ((e.key === ArrowDown || e.key === ArrowUp) && isInCell) {\n        activeElement.dispatchEvent(new GroupperMoveFocusEvent({ action: GroupperMoveFocusActions.Escape }));\n\n        activeElement = targetDocument.activeElement;\n\n        if (activeElement) {\n          activeElement.dispatchEvent(new MoverMoveFocusEvent({ key: MoverKeys[e.key] }));\n        }\n      }\n    },\n    [targetDocument, findFirstFocusable],\n  );\n\n  return {\n    onTableKeyDown: onKeyDown,\n    tableTabsterAttribute: gridAttr,\n    tableRowTabsterAttribute: rowAttr,\n  };\n}\n"],"names":["useTableCompositeNavigation","horizontalAttr","useArrowNavigationGroup","axis","gridAttr","groupperAttr","useFocusableGroup","tabBehavior","findFirstFocusable","useFocusFinders","targetDocument","useFluent","rowAttr","useMergedTabsterAttributes_unstable","onKeyDown","React","useCallback","e","activeElement","currentTarget","contains","activeElementRole","getAttribute","key","ArrowRight","isHTMLElement","focus","isInCell","cur","curRole","parentElement","ArrowDown","ArrowUp","dispatchEvent","GroupperMoveFocusEvent","action","GroupperMoveFocusActions","Escape","MoverMoveFocusEvent","MoverKeys","onTableKeyDown","tableTabsterAttribute","tableRowTabsterAttribute"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAgBgBA;;;eAAAA;;;;iEAhBO;qCACyB;8BACD;8BAWxC;gCACuB;AAEvB,SAASA;IAKd,MAAMC,iBAAiBC,IAAAA,qCAAAA,EAAwB;QAAEC,MAAM;IAAa;IACpE,MAAMC,WAAWF,IAAAA,qCAAAA,EAAwB;QAAEC,MAAM;IAAO;IACxD,MAAME,eAAeC,IAAAA,+BAAAA,EAAkB;QAAEC,aAAa;IAAqB;IAC3E,MAAM,EAAEC,kBAAkB,EAAE,GAAGC,IAAAA,6BAAAA;IAC/B,MAAM,EAAEC,cAAc,EAAE,GAAGC,IAAAA,uCAAAA;IAE3B,MAAMC,UAAUC,IAAAA,iDAAAA,EAAoCZ,gBAAgBI;IAEpE,MAAMS,YAAwCC,OAAMC,WAAW,CAC7DC,CAAAA;QACE,IAAI,CAACP,gBAAgB;YACnB;QACF;QAEA,IAAIQ,gBAAgBR,eAAeQ,aAAa;QAChD,IAAI,CAACA,iBAAiB,CAACD,EAAEE,aAAa,CAACC,QAAQ,CAACF,gBAAgB;YAC9D;QACF;QACA,MAAMG,oBAAoBH,cAAcI,YAAY,CAAC;QAErD,0DAA0D;QAC1D,IAAIL,EAAEM,GAAG,KAAKC,wBAAAA,IAAcH,sBAAsB,SAASI,IAAAA,6BAAAA,EAAcP,gBAAgB;gBACvFV;YAAAA,CAAAA,sBAAAA,mBAAmBU,cAAAA,MAAAA,QAAnBV,wBAAAA,KAAAA,IAAAA,KAAAA,IAAAA,oBAAmCkB,KAAK;QAC1C;QAEA,IAAIL,sBAAsB,OAAO;YAC/B;QACF;QAEA,MAAMM,WAAW,AAAC,CAAA;YAChB,IAAIC,MAAMH,IAAAA,6BAAAA,EAAcP,iBAAiBA,gBAAgB;YACzD,MAAOU,IAAK;gBACV,MAAMC,UAAUD,IAAIN,YAAY,CAAC;gBACjC,IAAIO,YAAY,UAAUA,YAAY,YAAY;oBAChD,OAAO;gBACT;gBAEAD,MAAMA,IAAIE,aAAa;YACzB;YAEA,OAAO;QACT,CAAA;QAEA,+CAA+C;QAC/C,IAAI,AAACb,CAAAA,EAAEM,GAAG,KAAKQ,uBAAAA,IAAad,EAAEM,GAAG,KAAKS,qBAAM,AAANA,KAAYL,UAAU;YAC1DT,cAAce,aAAa,CAAC,IAAIC,oCAAAA,CAAuB;gBAAEC,QAAQC,sCAAAA,CAAyBC,MAAM;YAAC;YAEjGnB,gBAAgBR,eAAeQ,aAAa;YAE5C,IAAIA,eAAe;gBACjBA,cAAce,aAAa,CAAC,IAAIK,iCAAAA,CAAoB;oBAAEf,KAAKgB,uBAAS,CAACtB,EAAEM,GAAG,CAAC;gBAAC;YAC9E;QACF;IACF,GACA;QAACb;QAAgBF;KAAmB;IAGtC,OAAO;QACLgC,gBAAgB1B;QAChB2B,uBAAuBrC;QACvBsC,0BAA0B9B;IAC5B;AACF"}