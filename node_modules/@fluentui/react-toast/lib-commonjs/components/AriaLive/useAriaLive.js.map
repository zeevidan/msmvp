{"version":3,"sources":["../src/components/AriaLive/useAriaLive.ts"],"sourcesContent":["import * as React from 'react';\nimport { createPriorityQueue, useEventCallback, slot, useTimeout } from '@fluentui/react-utilities';\nimport type { AnnounceOptions, AriaLiveProps, AriaLiveState, LiveMessage } from './AriaLive.types';\n\n/** The duration the message needs to be in present in DOM for screen readers to register a change and announce */\nconst MESSAGE_DURATION = 500;\n\n/**\n * Create the state required to render AriaLive.\n *\n * The returned state can be modified with hooks such as useAriaLiveStyles_unstable,\n * before being passed to renderAriaLive_unstable.\n *\n * @param props - props from this instance of AriaLive\n */\nexport const useAriaLive_unstable = (props: AriaLiveProps): AriaLiveState => {\n  const [currentMessage, setCurrentMessage] = React.useState<LiveMessage | undefined>(undefined);\n  // Can't rely on Date.now() if user invokes announce more than once in a code block\n  const order = React.useRef(0);\n  const [messageQueue] = React.useState(() =>\n    createPriorityQueue<LiveMessage>((a, b) => {\n      if (a.politeness === b.politeness) {\n        return a.createdAt - b.createdAt;\n      }\n\n      return a.politeness === 'assertive' ? -1 : 1;\n    }),\n  );\n\n  const announce = useEventCallback((message: string, options: AnnounceOptions) => {\n    const { politeness } = options;\n    if (message === currentMessage?.message) {\n      return;\n    }\n\n    const liveMessage: LiveMessage = {\n      message,\n      politeness,\n      createdAt: order.current++,\n    };\n\n    if (!currentMessage) {\n      setCurrentMessage(liveMessage);\n    } else {\n      messageQueue.enqueue(liveMessage);\n    }\n  });\n\n  const [setMessageTimeout, clearMessageTimeout] = useTimeout();\n\n  React.useEffect(() => {\n    setMessageTimeout(() => {\n      if (messageQueue.peek()) {\n        setCurrentMessage(messageQueue.dequeue());\n      } else {\n        setCurrentMessage(undefined);\n      }\n    }, MESSAGE_DURATION);\n\n    return () => clearMessageTimeout();\n  }, [currentMessage, messageQueue, setMessageTimeout, clearMessageTimeout]);\n\n  React.useImperativeHandle(props.announceRef, () => announce);\n\n  const politeMessage = currentMessage?.politeness === 'polite' ? currentMessage.message : undefined;\n  const assertiveMessage = currentMessage?.politeness === 'assertive' ? currentMessage.message : undefined;\n\n  return {\n    components: {\n      assertive: 'div',\n      polite: 'div',\n    },\n\n    assertive: slot.always(props.assertive, {\n      defaultProps: { 'aria-live': 'assertive', children: assertiveMessage },\n      elementType: 'div',\n    }),\n    polite: slot.always(props.polite, {\n      defaultProps: { 'aria-live': 'polite', children: politeMessage },\n      elementType: 'div',\n    }),\n  };\n};\n"],"names":["useAriaLive_unstable","MESSAGE_DURATION","props","currentMessage","setCurrentMessage","React","useState","undefined","order","useRef","messageQueue","createPriorityQueue","a","b","politeness","createdAt","announce","useEventCallback","message","options","liveMessage","current","enqueue","setMessageTimeout","clearMessageTimeout","useTimeout","useEffect","peek","dequeue","useImperativeHandle","announceRef","politeMessage","assertiveMessage","components","assertive","polite","slot","always","defaultProps","children","elementType"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAeaA;;;eAAAA;;;;iEAfU;gCACiD;AAGxE,gHAAgH,GAChH,MAAMC,mBAAmB;AAUlB,MAAMD,uBAAuB,CAACE;IACnC,MAAM,CAACC,gBAAgBC,kBAAkB,GAAGC,OAAMC,QAAQ,CAA0BC;IACpF,mFAAmF;IACnF,MAAMC,QAAQH,OAAMI,MAAM,CAAC;IAC3B,MAAM,CAACC,aAAa,GAAGL,OAAMC,QAAQ,CAAC,IACpCK,IAAAA,mCAAAA,EAAiC,CAACC,GAAGC;YACnC,IAAID,EAAEE,UAAU,KAAKD,EAAEC,UAAU,EAAE;gBACjC,OAAOF,EAAEG,SAAS,GAAGF,EAAEE,SAAS;YAClC;YAEA,OAAOH,EAAEE,UAAU,KAAK,cAAc,CAAC,IAAI;QAC7C;IAGF,MAAME,WAAWC,IAAAA,gCAAAA,EAAiB,CAACC,SAAiBC;QAClD,MAAM,EAAEL,UAAU,EAAE,GAAGK;QACvB,IAAID,YAAYf,CAAAA,mBAAAA,QAAAA,mBAAAA,KAAAA,IAAAA,KAAAA,IAAAA,eAAgBe,OAAO,AAAPA,GAAS;YACvC;QACF;QAEA,MAAME,cAA2B;YAC/BF;YACAJ;YACAC,WAAWP,MAAMa,OAAO;QAC1B;QAEA,IAAI,CAAClB,gBAAgB;YACnBC,kBAAkBgB;QACpB,OAAO;YACLV,aAAaY,OAAO,CAACF;QACvB;IACF;IAEA,MAAM,CAACG,mBAAmBC,oBAAoB,GAAGC,IAAAA,0BAAAA;IAEjDpB,OAAMqB,SAAS,CAAC;QACdH,kBAAkB;YAChB,IAAIb,aAAaiB,IAAI,IAAI;gBACvBvB,kBAAkBM,aAAakB,OAAO;YACxC,OAAO;gBACLxB,kBAAkBG;YACpB;QACF,GAAGN;QAEH,OAAO,IAAMuB;IACf,GAAG;QAACrB;QAAgBO;QAAca;QAAmBC;KAAoB;IAEzEnB,OAAMwB,mBAAmB,CAAC3B,MAAM4B,WAAW,EAAE,IAAMd;IAEnD,MAAMe,gBAAgB5B,CAAAA,mBAAAA,QAAAA,mBAAAA,KAAAA,IAAAA,KAAAA,IAAAA,eAAgBW,UAAU,AAAVA,MAAe,WAAWX,eAAee,OAAO,GAAGX;IACzF,MAAMyB,mBAAmB7B,CAAAA,mBAAAA,QAAAA,mBAAAA,KAAAA,IAAAA,KAAAA,IAAAA,eAAgBW,UAAU,AAAVA,MAAe,cAAcX,eAAee,OAAO,GAAGX;IAE/F,OAAO;QACL0B,YAAY;YACVC,WAAW;YACXC,QAAQ;QACV;QAEAD,WAAWE,oBAAAA,CAAKC,MAAM,CAACnC,MAAMgC,SAAS,EAAE;YACtCI,cAAc;gBAAE,aAAa;gBAAaC,UAAUP;YAAiB;YACrEQ,aAAa;QACf;QACAL,QAAQC,oBAAAA,CAAKC,MAAM,CAACnC,MAAMiC,MAAM,EAAE;YAChCG,cAAc;gBAAE,aAAa;gBAAUC,UAAUR;YAAc;YAC/DS,aAAa;QACf;IACF;AACF"}