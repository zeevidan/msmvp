{"version":3,"sources":["../src/components/Toaster/useToasterFocusManagement.ts"],"sourcesContent":["import { isHTMLElement } from '@fluentui/react-utilities';\nimport * as React from 'react';\nimport { useFluent_unstable as useFluent } from '@fluentui/react-shared-contexts';\nimport { ArrowDown, ArrowUp } from '@fluentui/keyboard-keys';\nimport { toastContainerClassNames } from '../ToastContainer';\n\nconst noop = () => undefined;\n\n/**\n * @internal\n */\nexport function useToasterFocusManagement_unstable(pauseAllToasts: () => void, playAllToasts: () => void) {\n  const { targetDocument } = useFluent();\n  const cleanupListenersRef = React.useRef<() => void>(noop);\n\n  return React.useCallback(\n    (el: HTMLDivElement) => {\n      if (!el || !targetDocument) {\n        cleanupListenersRef.current();\n        cleanupListenersRef.current = noop;\n        return;\n      }\n\n      const toastContainerWalker = targetDocument.createTreeWalker(el, NodeFilter.SHOW_ELEMENT, {\n        acceptNode(node: Node) {\n          if (isHTMLElement(node) && node.classList.contains(toastContainerClassNames.root)) {\n            return NodeFilter.FILTER_ACCEPT;\n          }\n\n          return NodeFilter.FILTER_SKIP;\n        },\n      });\n\n      /**\n       * FIXME: https://github.com/microsoft/tabster/issues/299\n       * Toasts  should be arrow navigable and focus should be trapped in a stack of tasts\n       * This is a temporary measure, Tabster does not have an API yet to enable mover arrow keys from within grouppers\n       * Once tabster fully supports this use case, remove this hook\n       */\n      const keydownListener = (e: KeyboardEvent) => {\n        const { target, key } = e;\n        if (!isHTMLElement(target)) {\n          return;\n        }\n\n        if (key === ArrowDown) {\n          toastContainerWalker.currentNode = target;\n          let nextToastContainer = toastContainerWalker.nextNode();\n          if (!nextToastContainer) {\n            toastContainerWalker.currentNode = el;\n            nextToastContainer = toastContainerWalker.nextNode();\n          }\n\n          if (isHTMLElement(nextToastContainer)) {\n            nextToastContainer.focus();\n          }\n        }\n\n        if (key === ArrowUp) {\n          toastContainerWalker.currentNode = target;\n          let prevToastContainer = toastContainerWalker.previousNode();\n          if (prevToastContainer && prevToastContainer.contains(target)) {\n            prevToastContainer = toastContainerWalker.previousNode();\n          }\n\n          if (!prevToastContainer) {\n            toastContainerWalker.currentNode = el;\n            prevToastContainer = toastContainerWalker.lastChild();\n          }\n\n          if (isHTMLElement(prevToastContainer)) {\n            prevToastContainer.focus();\n          }\n        }\n      };\n\n      const focusInListener = (e: FocusEvent) => {\n        if (\n          isHTMLElement(e.currentTarget) &&\n          !e.currentTarget.contains(isHTMLElement(e.relatedTarget) ? e.relatedTarget : null)\n        ) {\n          pauseAllToasts();\n        }\n      };\n\n      const focusOutListener = (e: FocusEvent) => {\n        if (\n          isHTMLElement(e.currentTarget) &&\n          !e.currentTarget.contains(isHTMLElement(e.relatedTarget) ? e.relatedTarget : null)\n        ) {\n          playAllToasts();\n        }\n      };\n\n      el.addEventListener('keydown', keydownListener);\n      el.addEventListener('focusin', focusInListener);\n      el.addEventListener('focusout', focusOutListener);\n\n      cleanupListenersRef.current = () => {\n        el.removeEventListener('keydown', keydownListener);\n        el.removeEventListener('focusin', focusInListener);\n        el.removeEventListener('focusout', focusOutListener);\n      };\n    },\n    [targetDocument, pauseAllToasts, playAllToasts],\n  );\n}\n"],"names":["useToasterFocusManagement_unstable","noop","undefined","pauseAllToasts","playAllToasts","targetDocument","useFluent","cleanupListenersRef","React","useRef","useCallback","el","current","toastContainerWalker","createTreeWalker","NodeFilter","SHOW_ELEMENT","acceptNode","node","isHTMLElement","classList","contains","toastContainerClassNames","root","FILTER_ACCEPT","FILTER_SKIP","keydownListener","e","target","key","ArrowDown","currentNode","nextToastContainer","nextNode","focus","ArrowUp","prevToastContainer","previousNode","lastChild","focusInListener","currentTarget","relatedTarget","focusOutListener","addEventListener","removeEventListener"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAWgBA;;;eAAAA;;;;gCAXc;iEACP;qCACyB;8BACb;gCACM;AAEzC,MAAMC,OAAO,IAAMC;AAKZ,SAASF,mCAAmCG,cAA0B,EAAEC,aAAyB;IACtG,MAAM,EAAEC,cAAc,EAAE,GAAGC,IAAAA,uCAAAA;IAC3B,MAAMC,sBAAsBC,OAAMC,MAAM,CAAaR;IAErD,OAAOO,OAAME,WAAW,CACtB,CAACC;QACC,IAAI,CAACA,MAAM,CAACN,gBAAgB;YAC1BE,oBAAoBK,OAAO;YAC3BL,oBAAoBK,OAAO,GAAGX;YAC9B;QACF;QAEA,MAAMY,uBAAuBR,eAAeS,gBAAgB,CAACH,IAAII,WAAWC,YAAY,EAAE;YACxFC,YAAWC,IAAU;gBACnB,IAAIC,IAAAA,6BAAAA,EAAcD,SAASA,KAAKE,SAAS,CAACC,QAAQ,CAACC,wCAAAA,CAAyBC,IAAI,GAAG;oBACjF,OAAOR,WAAWS,aAAa;gBACjC;gBAEA,OAAOT,WAAWU,WAAW;YAC/B;QACF;QAEA;;;;;OAKC,GACD,MAAMC,kBAAkB,CAACC;YACvB,MAAM,EAAEC,MAAM,EAAEC,GAAG,EAAE,GAAGF;YACxB,IAAI,CAACR,IAAAA,6BAAAA,EAAcS,SAAS;gBAC1B;YACF;YAEA,IAAIC,QAAQC,uBAAAA,EAAW;gBACrBjB,qBAAqBkB,WAAW,GAAGH;gBACnC,IAAII,qBAAqBnB,qBAAqBoB,QAAQ;gBACtD,IAAI,CAACD,oBAAoB;oBACvBnB,qBAAqBkB,WAAW,GAAGpB;oBACnCqB,qBAAqBnB,qBAAqBoB,QAAQ;gBACpD;gBAEA,IAAId,IAAAA,6BAAAA,EAAca,qBAAqB;oBACrCA,mBAAmBE,KAAK;gBAC1B;YACF;YAEA,IAAIL,QAAQM,qBAAAA,EAAS;gBACnBtB,qBAAqBkB,WAAW,GAAGH;gBACnC,IAAIQ,qBAAqBvB,qBAAqBwB,YAAY;gBAC1D,IAAID,sBAAsBA,mBAAmBf,QAAQ,CAACO,SAAS;oBAC7DQ,qBAAqBvB,qBAAqBwB,YAAY;gBACxD;gBAEA,IAAI,CAACD,oBAAoB;oBACvBvB,qBAAqBkB,WAAW,GAAGpB;oBACnCyB,qBAAqBvB,qBAAqByB,SAAS;gBACrD;gBAEA,IAAInB,IAAAA,6BAAAA,EAAciB,qBAAqB;oBACrCA,mBAAmBF,KAAK;gBAC1B;YACF;QACF;QAEA,MAAMK,kBAAkB,CAACZ;YACvB,IACER,IAAAA,6BAAAA,EAAcQ,EAAEa,aAAa,KAC7B,CAACb,EAAEa,aAAa,CAACnB,QAAQ,CAACF,IAAAA,6BAAAA,EAAcQ,EAAEc,aAAa,IAAId,EAAEc,aAAa,GAAG,OAC7E;gBACAtC;YACF;QACF;QAEA,MAAMuC,mBAAmB,CAACf;YACxB,IACER,IAAAA,6BAAAA,EAAcQ,EAAEa,aAAa,KAC7B,CAACb,EAAEa,aAAa,CAACnB,QAAQ,CAACF,IAAAA,6BAAAA,EAAcQ,EAAEc,aAAa,IAAId,EAAEc,aAAa,GAAG,OAC7E;gBACArC;YACF;QACF;QAEAO,GAAGgC,gBAAgB,CAAC,WAAWjB;QAC/Bf,GAAGgC,gBAAgB,CAAC,WAAWJ;QAC/B5B,GAAGgC,gBAAgB,CAAC,YAAYD;QAEhCnC,oBAAoBK,OAAO,GAAG;YAC5BD,GAAGiC,mBAAmB,CAAC,WAAWlB;YAClCf,GAAGiC,mBAAmB,CAAC,WAAWL;YAClC5B,GAAGiC,mBAAmB,CAAC,YAAYF;QACrC;IACF,GACA;QAACrC;QAAgBF;QAAgBC;KAAc;AAEnD"}