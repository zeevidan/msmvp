{"version":3,"sources":["../src/components/TagGroup/useTagGroup.ts"],"sourcesContent":["import * as React from 'react';\nimport {\n  getIntrinsicElementProps,\n  useControllableState,\n  useEventCallback,\n  mergeCallbacks,\n  useMergedRefs,\n  slot,\n} from '@fluentui/react-utilities';\nimport type { TagGroupProps, TagGroupState } from './TagGroup.types';\nimport { useArrowNavigationGroup, useFocusFinders } from '@fluentui/react-tabster';\nimport { useFluent_unstable as useFluent } from '@fluentui/react-shared-contexts';\nimport { interactionTagSecondaryClassNames } from '../InteractionTagSecondary/useInteractionTagSecondaryStyles.styles';\nimport type { TagValue } from '../../utils/types';\n\n/**\n * Create the state required to render TagGroup.\n *\n * The returned state can be modified with hooks such as useTagGroupStyles_unstable,\n * before being passed to renderTagGroup_unstable.\n *\n * @param props - props from this instance of TagGroup\n * @param ref - reference to root HTMLDivElement of TagGroup\n */\nexport const useTagGroup_unstable = (props: TagGroupProps, ref: React.Ref<HTMLDivElement>): TagGroupState => {\n  const {\n    onDismiss,\n    disabled = false,\n    defaultSelectedValues,\n    size = 'medium',\n    appearance = 'filled',\n    dismissible = false,\n    role = 'toolbar',\n    onTagSelect,\n    selectedValues,\n    ...rest\n  } = props;\n\n  const innerRef = React.useRef<HTMLElement>();\n  const { targetDocument } = useFluent();\n  const { findNextFocusable, findPrevFocusable } = useFocusFinders();\n\n  const [items, setItems] = useControllableState<Array<TagValue>>({\n    defaultState: defaultSelectedValues,\n    state: selectedValues,\n    initialState: [],\n  });\n\n  const handleTagDismiss: TagGroupState['handleTagDismiss'] = useEventCallback((e, data) => {\n    onDismiss?.(e, data);\n\n    // set focus after tag dismiss\n    const activeElement = targetDocument?.activeElement;\n    if (innerRef.current?.contains(activeElement as HTMLElement)) {\n      // focus on next tag only if the active element is within the current tag group\n      const next = findNextFocusable(activeElement as HTMLElement, { container: innerRef.current });\n      if (next) {\n        next.focus();\n        return;\n      }\n\n      // if there is no next focusable, focus on the previous focusable\n      if (activeElement?.className.includes(interactionTagSecondaryClassNames.root)) {\n        const prev = findPrevFocusable(activeElement.parentElement as HTMLElement, { container: innerRef.current });\n        prev?.focus();\n      } else {\n        const prev = findPrevFocusable(activeElement as HTMLElement, { container: innerRef.current });\n        prev?.focus();\n      }\n    }\n  });\n\n  const handleTagSelect: TagGroupState['handleTagSelect'] = useEventCallback(\n    mergeCallbacks(onTagSelect, (_, data) => {\n      if (items.includes(data.value)) {\n        setItems(items.filter(item => item !== data.value));\n      } else {\n        setItems([...items, data.value]);\n      }\n    }),\n  );\n\n  const arrowNavigationProps = useArrowNavigationGroup({\n    circular: true,\n    axis: 'both',\n    memorizeCurrent: true,\n  });\n\n  return {\n    handleTagDismiss,\n    handleTagSelect: onTagSelect ? handleTagSelect : undefined,\n    selectedValues: items,\n    role,\n    size,\n    disabled,\n    appearance,\n    dismissible,\n    components: {\n      root: 'div',\n    },\n\n    root: slot.always(\n      getIntrinsicElementProps('div', {\n        // FIXME:\n        // `ref` is wrongly assigned to be `HTMLElement` instead of `HTMLDivElement`\n        // but since it would be a breaking change to fix it, we are casting ref to it's proper type\n        ref: useMergedRefs(ref, innerRef) as React.Ref<HTMLDivElement>,\n        role,\n        'aria-disabled': disabled,\n        ...arrowNavigationProps,\n        ...rest,\n      }),\n      { elementType: 'div' },\n    ),\n  };\n};\n"],"names":["React","getIntrinsicElementProps","useControllableState","useEventCallback","mergeCallbacks","useMergedRefs","slot","useArrowNavigationGroup","useFocusFinders","useFluent_unstable","useFluent","interactionTagSecondaryClassNames","useTagGroup_unstable","props","ref","onDismiss","disabled","defaultSelectedValues","size","appearance","dismissible","role","onTagSelect","selectedValues","rest","innerRef","useRef","targetDocument","findNextFocusable","findPrevFocusable","items","setItems","defaultState","state","initialState","handleTagDismiss","e","data","activeElement","current","contains","next","container","focus","className","includes","root","prev","parentElement","handleTagSelect","_","value","filter","item","arrowNavigationProps","circular","axis","memorizeCurrent","undefined","components","always","elementType"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"AAAA,YAAYA,WAAW,QAAQ;AAC/B,SACEC,wBAAwB,EACxBC,oBAAoB,EACpBC,gBAAgB,EAChBC,cAAc,EACdC,aAAa,EACbC,IAAI,QACC,4BAA4B;AAEnC,SAASC,uBAAuB,EAAEC,eAAe,QAAQ,0BAA0B;AACnF,SAASC,sBAAsBC,SAAS,QAAQ,kCAAkC;AAClF,SAASC,iCAAiC,QAAQ,qEAAqE;AAGvH;;;;;;;;CAQC,GACD,OAAO,MAAMC,uBAAuB,CAACC,OAAsBC;IACzD,MAAM,EACJC,SAAS,EACTC,WAAW,KAAK,EAChBC,qBAAqB,EACrBC,OAAO,QAAQ,EACfC,aAAa,QAAQ,EACrBC,cAAc,KAAK,EACnBC,OAAO,SAAS,EAChBC,WAAW,EACXC,cAAc,EACd,GAAGC,MACJ,GAAGX;IAEJ,MAAMY,WAAWzB,MAAM0B,MAAM;IAC7B,MAAM,EAAEC,cAAc,EAAE,GAAGjB;IAC3B,MAAM,EAAEkB,iBAAiB,EAAEC,iBAAiB,EAAE,GAAGrB;IAEjD,MAAM,CAACsB,OAAOC,SAAS,GAAG7B,qBAAsC;QAC9D8B,cAAcf;QACdgB,OAAOV;QACPW,cAAc,EAAE;IAClB;IAEA,MAAMC,mBAAsDhC,iBAAiB,CAACiC,GAAGC;YAK3EZ;QAJJV,sBAAAA,gCAAAA,UAAYqB,GAAGC;QAEf,8BAA8B;QAC9B,MAAMC,gBAAgBX,2BAAAA,qCAAAA,eAAgBW,aAAa;QACnD,KAAIb,oBAAAA,SAASc,OAAO,cAAhBd,wCAAAA,kBAAkBe,QAAQ,CAACF,gBAA+B;YAC5D,+EAA+E;YAC/E,MAAMG,OAAOb,kBAAkBU,eAA8B;gBAAEI,WAAWjB,SAASc,OAAO;YAAC;YAC3F,IAAIE,MAAM;gBACRA,KAAKE,KAAK;gBACV;YACF;YAEA,iEAAiE;YACjE,IAAIL,0BAAAA,oCAAAA,cAAeM,SAAS,CAACC,QAAQ,CAAClC,kCAAkCmC,IAAI,GAAG;gBAC7E,MAAMC,OAAOlB,kBAAkBS,cAAcU,aAAa,EAAiB;oBAAEN,WAAWjB,SAASc,OAAO;gBAAC;gBACzGQ,iBAAAA,2BAAAA,KAAMJ,KAAK;YACb,OAAO;gBACL,MAAMI,OAAOlB,kBAAkBS,eAA8B;oBAAEI,WAAWjB,SAASc,OAAO;gBAAC;gBAC3FQ,iBAAAA,2BAAAA,KAAMJ,KAAK;YACb;QACF;IACF;IAEA,MAAMM,kBAAoD9C,iBACxDC,eAAekB,aAAa,CAAC4B,GAAGb;QAC9B,IAAIP,MAAMe,QAAQ,CAACR,KAAKc,KAAK,GAAG;YAC9BpB,SAASD,MAAMsB,MAAM,CAACC,CAAAA,OAAQA,SAAShB,KAAKc,KAAK;QACnD,OAAO;YACLpB,SAAS;mBAAID;gBAAOO,KAAKc,KAAK;aAAC;QACjC;IACF;IAGF,MAAMG,uBAAuB/C,wBAAwB;QACnDgD,UAAU;QACVC,MAAM;QACNC,iBAAiB;IACnB;IAEA,OAAO;QACLtB;QACAc,iBAAiB3B,cAAc2B,kBAAkBS;QACjDnC,gBAAgBO;QAChBT;QACAH;QACAF;QACAG;QACAC;QACAuC,YAAY;YACVb,MAAM;QACR;QAEAA,MAAMxC,KAAKsD,MAAM,CACf3D,yBAAyB,OAAO;YAC9B,SAAS;YACT,4EAA4E;YAC5E,4FAA4F;YAC5Fa,KAAKT,cAAcS,KAAKW;YACxBJ;YACA,iBAAiBL;YACjB,GAAGsC,oBAAoB;YACvB,GAAG9B,IAAI;QACT,IACA;YAAEqC,aAAa;QAAM;IAEzB;AACF,EAAE"}