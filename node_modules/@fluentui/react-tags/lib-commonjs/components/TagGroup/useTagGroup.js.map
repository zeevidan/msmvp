{"version":3,"sources":["../src/components/TagGroup/useTagGroup.ts"],"sourcesContent":["import * as React from 'react';\nimport {\n  getIntrinsicElementProps,\n  useControllableState,\n  useEventCallback,\n  mergeCallbacks,\n  useMergedRefs,\n  slot,\n} from '@fluentui/react-utilities';\nimport type { TagGroupProps, TagGroupState } from './TagGroup.types';\nimport { useArrowNavigationGroup, useFocusFinders } from '@fluentui/react-tabster';\nimport { useFluent_unstable as useFluent } from '@fluentui/react-shared-contexts';\nimport { interactionTagSecondaryClassNames } from '../InteractionTagSecondary/useInteractionTagSecondaryStyles.styles';\nimport type { TagValue } from '../../utils/types';\n\n/**\n * Create the state required to render TagGroup.\n *\n * The returned state can be modified with hooks such as useTagGroupStyles_unstable,\n * before being passed to renderTagGroup_unstable.\n *\n * @param props - props from this instance of TagGroup\n * @param ref - reference to root HTMLDivElement of TagGroup\n */\nexport const useTagGroup_unstable = (props: TagGroupProps, ref: React.Ref<HTMLDivElement>): TagGroupState => {\n  const {\n    onDismiss,\n    disabled = false,\n    defaultSelectedValues,\n    size = 'medium',\n    appearance = 'filled',\n    dismissible = false,\n    role = 'toolbar',\n    onTagSelect,\n    selectedValues,\n    ...rest\n  } = props;\n\n  const innerRef = React.useRef<HTMLElement>();\n  const { targetDocument } = useFluent();\n  const { findNextFocusable, findPrevFocusable } = useFocusFinders();\n\n  const [items, setItems] = useControllableState<Array<TagValue>>({\n    defaultState: defaultSelectedValues,\n    state: selectedValues,\n    initialState: [],\n  });\n\n  const handleTagDismiss: TagGroupState['handleTagDismiss'] = useEventCallback((e, data) => {\n    onDismiss?.(e, data);\n\n    // set focus after tag dismiss\n    const activeElement = targetDocument?.activeElement;\n    if (innerRef.current?.contains(activeElement as HTMLElement)) {\n      // focus on next tag only if the active element is within the current tag group\n      const next = findNextFocusable(activeElement as HTMLElement, { container: innerRef.current });\n      if (next) {\n        next.focus();\n        return;\n      }\n\n      // if there is no next focusable, focus on the previous focusable\n      if (activeElement?.className.includes(interactionTagSecondaryClassNames.root)) {\n        const prev = findPrevFocusable(activeElement.parentElement as HTMLElement, { container: innerRef.current });\n        prev?.focus();\n      } else {\n        const prev = findPrevFocusable(activeElement as HTMLElement, { container: innerRef.current });\n        prev?.focus();\n      }\n    }\n  });\n\n  const handleTagSelect: TagGroupState['handleTagSelect'] = useEventCallback(\n    mergeCallbacks(onTagSelect, (_, data) => {\n      if (items.includes(data.value)) {\n        setItems(items.filter(item => item !== data.value));\n      } else {\n        setItems([...items, data.value]);\n      }\n    }),\n  );\n\n  const arrowNavigationProps = useArrowNavigationGroup({\n    circular: true,\n    axis: 'both',\n    memorizeCurrent: true,\n  });\n\n  return {\n    handleTagDismiss,\n    handleTagSelect: onTagSelect ? handleTagSelect : undefined,\n    selectedValues: items,\n    role,\n    size,\n    disabled,\n    appearance,\n    dismissible,\n    components: {\n      root: 'div',\n    },\n\n    root: slot.always(\n      getIntrinsicElementProps('div', {\n        // FIXME:\n        // `ref` is wrongly assigned to be `HTMLElement` instead of `HTMLDivElement`\n        // but since it would be a breaking change to fix it, we are casting ref to it's proper type\n        ref: useMergedRefs(ref, innerRef) as React.Ref<HTMLDivElement>,\n        role,\n        'aria-disabled': disabled,\n        ...arrowNavigationProps,\n        ...rest,\n      }),\n      { elementType: 'div' },\n    ),\n  };\n};\n"],"names":["useTagGroup_unstable","props","ref","onDismiss","disabled","defaultSelectedValues","size","appearance","dismissible","role","onTagSelect","selectedValues","rest","innerRef","React","useRef","targetDocument","useFluent","findNextFocusable","findPrevFocusable","useFocusFinders","items","setItems","useControllableState","defaultState","state","initialState","handleTagDismiss","useEventCallback","e","data","activeElement","current","contains","next","container","focus","className","includes","interactionTagSecondaryClassNames","root","prev","parentElement","handleTagSelect","mergeCallbacks","_","value","filter","item","arrowNavigationProps","useArrowNavigationGroup","circular","axis","memorizeCurrent","undefined","components","slot","always","getIntrinsicElementProps","useMergedRefs","elementType"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}