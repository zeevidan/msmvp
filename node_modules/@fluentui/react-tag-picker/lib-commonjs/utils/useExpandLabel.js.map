{"version":3,"sources":["../src/utils/useExpandLabel.ts"],"sourcesContent":["import * as React from 'react';\nimport { useTagPickerContext_unstable } from '../contexts/TagPickerContext';\nimport { useFluent_unstable as useFluent } from '@fluentui/react-shared-contexts';\nimport { TagPickerControlState } from '../TagPickerControl';\n\nexport function useExpandLabel(options: { tagPickerId: string; state: Pick<TagPickerControlState, 'expandIcon'> }) {\n  const { tagPickerId, state } = options;\n  const { targetDocument } = useFluent();\n  const triggerRef = useTagPickerContext_unstable(ctx => ctx.triggerRef);\n  const expandIconRef = React.useRef<HTMLSpanElement>(null);\n\n  const hasExpandIcon = !!state.expandIcon;\n  const {\n    'aria-label': expandIconAriaLabel,\n    'aria-labelledby': expandIconAriaLabelledby,\n    id: expandIconId,\n  } = state.expandIcon || {};\n\n  // If aria-label or aria-labelledby changes, recalculate aria-label and aria-labelledby for the expandIcon\n  // The expandIcon's label is calculated based on the input's label\n  // TODO: investigate ways to enforce client to provide a label rather than need to calculate it\n  const getExpandLabel = React.useCallback(\n    (ariaLabel?: string | null, ariaLabelledBy?: string | null) => {\n      let expandAriaLabel = undefined;\n      let expandAriaLabelledBy = undefined;\n      let expandId = undefined;\n\n      if (hasExpandIcon) {\n        const hasExpandLabel = expandIconAriaLabel || expandIconAriaLabelledby;\n        // If there is no explicit aria-label, calculate default accName attribute for expandIcon button,\n        // using the following steps:\n        // 1. If there is an aria-label, it is \"Open [aria-label]\"\n        // 2. If there is an aria-labelledby, it is \"Open [aria-labelledby target]\" (using aria-labelledby + ids)\n        // 3. If there is no aria-label/ledby attr, it falls back to \"Open\"\n        // We can't fall back to a label/htmlFor name because of https://github.com/w3c/accname/issues/179\n        const defaultOpenString = 'Open'; // this is english-only since it is the fallback\n        if (!hasExpandLabel) {\n          if (ariaLabelledBy) {\n            expandAriaLabel = defaultOpenString;\n            expandId = expandIconId ?? `${tagPickerId}-chevron`;\n            expandAriaLabelledBy = `${expandId} ${ariaLabelledBy}`;\n          } else if (ariaLabel) {\n            expandAriaLabel = `${defaultOpenString} ${ariaLabel}`;\n          } else {\n            expandAriaLabel = defaultOpenString;\n          }\n        }\n      }\n\n      return { expandAriaLabel, expandAriaLabelledBy, expandId };\n    },\n    [expandIconAriaLabel, expandIconAriaLabelledby, expandIconId, hasExpandIcon, tagPickerId],\n  );\n\n  const setExpandLabel = React.useCallback(() => {\n    const inputAriaLabel = triggerRef.current?.getAttribute('aria-label');\n    const inputAriaLabelledBy = triggerRef.current?.getAttribute('aria-labelledby');\n\n    const { expandAriaLabel, expandAriaLabelledBy, expandId } = getExpandLabel(inputAriaLabel, inputAriaLabelledBy);\n\n    if (expandAriaLabelledBy) {\n      expandIconRef.current?.setAttribute('aria-labelledby', expandAriaLabelledBy);\n    }\n    if (expandAriaLabel) {\n      expandIconRef.current?.setAttribute('aria-label', expandAriaLabel);\n    }\n    if (expandId) {\n      expandIconRef.current?.setAttribute('id', expandId);\n    }\n  }, [getExpandLabel, triggerRef]);\n\n  React.useEffect(() => {\n    const hasExpandLabel = expandIconAriaLabel || expandIconAriaLabelledby;\n    if (!targetDocument?.defaultView || !triggerRef.current || !hasExpandIcon || hasExpandLabel) {\n      return;\n    }\n\n    const win = targetDocument.defaultView;\n\n    // On first render, calculate the default aria-label and aria-labelledby for the expandIcon\n    setExpandLabel();\n\n    const observer = new win.MutationObserver(setExpandLabel);\n    observer.observe(triggerRef.current, {\n      attributes: true,\n      attributeFilter: ['aria-label', 'aria-labelledby'],\n    });\n\n    return () => observer.disconnect();\n  }, [\n    getExpandLabel,\n    setExpandLabel,\n    expandIconAriaLabel,\n    expandIconAriaLabelledby,\n    hasExpandIcon,\n    tagPickerId,\n    triggerRef,\n    targetDocument,\n  ]);\n\n  return expandIconRef;\n}\n"],"names":["useExpandLabel","options","tagPickerId","state","targetDocument","useFluent","triggerRef","useTagPickerContext_unstable","ctx","expandIconRef","React","useRef","hasExpandIcon","expandIcon","expandIconAriaLabel","expandIconAriaLabelledby","id","expandIconId","getExpandLabel","useCallback","ariaLabel","ariaLabelledBy","expandAriaLabel","undefined","expandAriaLabelledBy","expandId","hasExpandLabel","defaultOpenString","setExpandLabel","inputAriaLabel","current","getAttribute","inputAriaLabelledBy","setAttribute","useEffect","defaultView","win","observer","MutationObserver","observe","attributes","attributeFilter","disconnect"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}