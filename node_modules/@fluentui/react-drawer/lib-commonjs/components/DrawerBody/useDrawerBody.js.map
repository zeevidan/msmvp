{"version":3,"sources":["../src/components/DrawerBody/useDrawerBody.ts"],"sourcesContent":["import * as React from 'react';\nimport {\n  mergeCallbacks,\n  slot,\n  useAnimationFrame,\n  useMergedRefs,\n  useIsomorphicLayoutEffect,\n  getIntrinsicElementProps,\n} from '@fluentui/react-utilities';\n\nimport { useDrawerContext_unstable } from '../../contexts/drawerContext';\nimport { DrawerScrollState } from '../../shared/DrawerBase.types';\n\nimport type { DrawerBodyProps, DrawerBodyState } from './DrawerBody.types';\n\n/**\n * @internal\n *\n * Get the current scroll state of the DrawerBody.\n *\n * @param element - HTMLElement to check scroll state of\n */\nconst getScrollState = ({ scrollTop, scrollHeight, clientHeight }: HTMLElement): DrawerScrollState => {\n  if (scrollHeight <= clientHeight) {\n    return 'none';\n  }\n\n  if (scrollTop === 0) {\n    return 'top';\n  }\n\n  if (scrollTop + clientHeight === scrollHeight) {\n    return 'bottom';\n  }\n\n  return 'middle';\n};\n\n/**\n * Create the state required to render DrawerBody.\n *\n * The returned state can be modified with hooks such as useDrawerBodyStyles_unstable,\n * before being passed to renderDrawerBody_unstable.\n *\n * @param props - props from this instance of DrawerBody\n * @param ref - reference to root HTMLElement of DrawerBody\n */\nexport const useDrawerBody_unstable = (props: DrawerBodyProps, ref: React.Ref<HTMLElement>): DrawerBodyState => {\n  const { setScrollState } = useDrawerContext_unstable();\n\n  const scrollRef = React.useRef<HTMLDivElement | null>(null);\n  const [setAnimationFrame, cancelAnimationFrame] = useAnimationFrame();\n\n  const updateScrollState = React.useCallback(() => {\n    if (!scrollRef.current) {\n      return;\n    }\n\n    setScrollState(getScrollState(scrollRef.current));\n  }, [setScrollState]);\n\n  const onScroll = React.useCallback(() => {\n    cancelAnimationFrame();\n    setAnimationFrame(() => updateScrollState());\n  }, [cancelAnimationFrame, setAnimationFrame, updateScrollState]);\n\n  useIsomorphicLayoutEffect(() => {\n    cancelAnimationFrame();\n    setAnimationFrame(() => updateScrollState());\n    /* update scroll state when children changes */\n    return () => cancelAnimationFrame();\n  }, [props.children, cancelAnimationFrame, updateScrollState, setAnimationFrame]);\n\n  useIsomorphicLayoutEffect(() => {\n    cancelAnimationFrame();\n    setAnimationFrame(() => updateScrollState());\n\n    return () => cancelAnimationFrame();\n  }, [cancelAnimationFrame, updateScrollState, setAnimationFrame]);\n\n  return {\n    components: {\n      root: 'div',\n    },\n\n    root: slot.always(\n      getIntrinsicElementProps<DrawerBodyProps>('div', {\n        // FIXME:\n        // `ref` is wrongly assigned to be `HTMLElement` instead of `HTMLDivElement`\n        // but since it would be a breaking change to fix it, we are casting ref to it's proper type\n        ref: useMergedRefs<HTMLDivElement>(ref as React.Ref<HTMLDivElement>, scrollRef),\n        ...props,\n        onScroll: mergeCallbacks(props.onScroll, onScroll),\n      }),\n      { elementType: 'div' },\n    ),\n  };\n};\n"],"names":["useDrawerBody_unstable","getScrollState","scrollTop","scrollHeight","clientHeight","props","ref","setScrollState","useDrawerContext_unstable","scrollRef","React","useRef","setAnimationFrame","cancelAnimationFrame","useAnimationFrame","updateScrollState","useCallback","current","onScroll","useIsomorphicLayoutEffect","children","components","root","slot","always","getIntrinsicElementProps","useMergedRefs","mergeCallbacks","elementType"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BA+CaA;;;eAAAA;;;;iEA/CU;gCAQhB;+BAEmC;AAK1C;;;;;;CAMC,GACD,MAAMC,iBAAiB,CAAC,EAAEC,SAAS,EAAEC,YAAY,EAAEC,YAAY,EAAe;IAC5E,IAAID,gBAAgBC,cAAc;QAChC,OAAO;IACT;IAEA,IAAIF,cAAc,GAAG;QACnB,OAAO;IACT;IAEA,IAAIA,YAAYE,iBAAiBD,cAAc;QAC7C,OAAO;IACT;IAEA,OAAO;AACT;AAWO,MAAMH,yBAAyB,CAACK,OAAwBC;IAC7D,MAAM,EAAEC,cAAc,EAAE,GAAGC,IAAAA,wCAAAA;IAE3B,MAAMC,YAAYC,OAAMC,MAAM,CAAwB;IACtD,MAAM,CAACC,mBAAmBC,qBAAqB,GAAGC,IAAAA,iCAAAA;IAElD,MAAMC,oBAAoBL,OAAMM,WAAW,CAAC;QAC1C,IAAI,CAACP,UAAUQ,OAAO,EAAE;YACtB;QACF;QAEAV,eAAeN,eAAeQ,UAAUQ,OAAO;IACjD,GAAG;QAACV;KAAe;IAEnB,MAAMW,WAAWR,OAAMM,WAAW,CAAC;QACjCH;QACAD,kBAAkB,IAAMG;IAC1B,GAAG;QAACF;QAAsBD;QAAmBG;KAAkB;IAE/DI,IAAAA,yCAAAA,EAA0B;QACxBN;QACAD,kBAAkB,IAAMG;QACxB,6CAA6C,GAC7C,OAAO,IAAMF;IACf,GAAG;QAACR,MAAMe,QAAQ;QAAEP;QAAsBE;QAAmBH;KAAkB;IAE/EO,IAAAA,yCAAAA,EAA0B;QACxBN;QACAD,kBAAkB,IAAMG;QAExB,OAAO,IAAMF;IACf,GAAG;QAACA;QAAsBE;QAAmBH;KAAkB;IAE/D,OAAO;QACLS,YAAY;YACVC,MAAM;QACR;QAEAA,MAAMC,oBAAAA,CAAKC,MAAM,CACfC,IAAAA,wCAAAA,EAA0C,OAAO;YAC/C,SAAS;YACT,4EAA4E;YAC5E,4FAA4F;YAC5FnB,KAAKoB,IAAAA,6BAAAA,EAA8BpB,KAAkCG;YACrE,GAAGJ,KAAK;YACRa,UAAUS,IAAAA,8BAAAA,EAAetB,MAAMa,QAAQ,EAAEA;QAC3C,IACA;YAAEU,aAAa;QAAM;IAEzB;AACF"}