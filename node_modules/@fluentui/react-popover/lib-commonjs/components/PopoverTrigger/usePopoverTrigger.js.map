{"version":3,"sources":["../src/components/PopoverTrigger/usePopoverTrigger.ts"],"sourcesContent":["import * as React from 'react';\nimport {\n  applyTriggerPropsToChildren,\n  getTriggerChild,\n  mergeCallbacks,\n  useMergedRefs,\n  useEventCallback,\n} from '@fluentui/react-utilities';\nimport { useModalAttributes } from '@fluentui/react-tabster';\nimport { usePopoverContext_unstable } from '../../popoverContext';\nimport type { PopoverTriggerProps, PopoverTriggerState } from './PopoverTrigger.types';\nimport { useARIAButtonProps } from '@fluentui/react-aria';\nimport { Escape } from '@fluentui/keyboard-keys';\n\n/**\n * Create the state required to render PopoverTrigger.\n *\n * The returned state can be modified with hooks such as usePopoverTriggerStyles,\n * before being passed to renderPopoverTrigger_unstable.\n *\n * @param props - props from this instance of PopoverTrigger\n */\nexport const usePopoverTrigger_unstable = (props: PopoverTriggerProps): PopoverTriggerState => {\n  const { children, disableButtonEnhancement = false } = props;\n  const child = getTriggerChild(children);\n\n  const open = usePopoverContext_unstable(context => context.open);\n  const setOpen = usePopoverContext_unstable(context => context.setOpen);\n  const toggleOpen = usePopoverContext_unstable(context => context.toggleOpen);\n  const triggerRef = usePopoverContext_unstable(context => context.triggerRef);\n  const openOnHover = usePopoverContext_unstable(context => context.openOnHover);\n  const openOnContext = usePopoverContext_unstable(context => context.openOnContext);\n  const { triggerAttributes } = useModalAttributes();\n\n  const onContextMenu = (e: React.MouseEvent<HTMLElement>) => {\n    if (openOnContext) {\n      e.preventDefault();\n      setOpen(e, true);\n    }\n  };\n\n  const onClick = (e: React.MouseEvent<HTMLElement>) => {\n    if (!openOnContext) {\n      toggleOpen(e);\n    }\n  };\n\n  const onKeyDown = (e: React.KeyboardEvent<HTMLElement>) => {\n    if (e.key === Escape && open && !e.isDefaultPrevented()) {\n      setOpen(e, false);\n      // stop propagation to avoid conflicting with other elements that listen for `Escape`\n      // e,g: Dialog, Popover, Menu and Tooltip\n      e.preventDefault();\n    }\n  };\n\n  const onMouseEnter = (e: React.MouseEvent<HTMLElement>) => {\n    if (openOnHover) {\n      setOpen(e, true);\n    }\n  };\n\n  const onMouseLeave = (e: React.MouseEvent<HTMLElement>) => {\n    if (openOnHover) {\n      setOpen(e, false);\n    }\n  };\n\n  const contextMenuProps = {\n    ...triggerAttributes,\n    'aria-expanded': `${open}`,\n    ...child?.props,\n    onMouseEnter: useEventCallback(mergeCallbacks(child?.props.onMouseEnter, onMouseEnter)),\n    onMouseLeave: useEventCallback(mergeCallbacks(child?.props.onMouseLeave, onMouseLeave)),\n    onContextMenu: useEventCallback(mergeCallbacks(child?.props.onContextMenu, onContextMenu)),\n    ref: useMergedRefs(triggerRef, child?.ref),\n  } as const;\n\n  const triggerChildProps = {\n    ...contextMenuProps,\n    onClick: useEventCallback(mergeCallbacks(child?.props.onClick, onClick)),\n    onKeyDown: useEventCallback(mergeCallbacks(child?.props.onKeyDown, onKeyDown)),\n  };\n\n  const ariaButtonTriggerChildProps = useARIAButtonProps(\n    child?.type === 'button' || child?.type === 'a' ? child.type : 'div',\n    triggerChildProps,\n  );\n\n  return {\n    children: applyTriggerPropsToChildren(\n      props.children,\n      useARIAButtonProps(\n        child?.type === 'button' || child?.type === 'a' ? child.type : 'div',\n        openOnContext ? contextMenuProps : disableButtonEnhancement ? triggerChildProps : ariaButtonTriggerChildProps,\n      ),\n    ),\n  };\n};\n"],"names":["usePopoverTrigger_unstable","props","children","disableButtonEnhancement","child","getTriggerChild","open","usePopoverContext_unstable","context","setOpen","toggleOpen","triggerRef","openOnHover","openOnContext","triggerAttributes","useModalAttributes","onContextMenu","e","preventDefault","onClick","onKeyDown","key","Escape","isDefaultPrevented","onMouseEnter","onMouseLeave","contextMenuProps","useEventCallback","mergeCallbacks","ref","useMergedRefs","triggerChildProps","ariaButtonTriggerChildProps","useARIAButtonProps","type","applyTriggerPropsToChildren"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}