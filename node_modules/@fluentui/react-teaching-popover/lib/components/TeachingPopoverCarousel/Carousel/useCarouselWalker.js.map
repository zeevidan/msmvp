{"version":3,"sources":["../src/components/TeachingPopoverCarousel/Carousel/useCarouselWalker.ts"],"sourcesContent":["import * as React from 'react';\nimport { isHTMLElement } from '@fluentui/react-utilities';\nimport { useFluent_unstable as useFluent } from '@fluentui/react-shared-contexts';\n\nimport { CAROUSEL_ACTIVE_ITEM, CAROUSEL_ITEM } from './constants';\n\nexport type CarouselWalker = {\n  find(value: string): { el: HTMLElement; value: string } | null;\n  nextPage(value: string): { el: HTMLElement; value: string } | null;\n  prevPage(value: string): { el: HTMLElement; value: string } | null;\n  active(): { el: HTMLElement; value: string } | null;\n};\n\nexport const useCarouselWalker_unstable = () => {\n  const { targetDocument } = useFluent();\n\n  const treeWalkerRef = React.useRef<TreeWalker | undefined>(targetDocument?.createTreeWalker(targetDocument.body));\n  const htmlRef = React.useRef<HTMLDivElement | null>(null);\n\n  const ref = React.useCallback(\n    (el: HTMLDivElement | null) => {\n      if (!targetDocument) {\n        return;\n      }\n\n      if (!el) {\n        return;\n      }\n\n      htmlRef.current = el;\n      treeWalkerRef.current = targetDocument.createTreeWalker(el, NodeFilter.SHOW_ELEMENT, {\n        acceptNode(node) {\n          if (!isHTMLElement(node)) {\n            return NodeFilter.FILTER_SKIP;\n          }\n\n          return node.hasAttribute(CAROUSEL_ITEM) ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_SKIP;\n        },\n      });\n    },\n    [targetDocument],\n  );\n\n  return {\n    ref,\n    walker: React.useMemo<CarouselWalker>(\n      () => ({\n        active() {\n          if (!htmlRef.current) {\n            return null;\n          }\n\n          const activeEl = htmlRef.current.querySelector(`[${CAROUSEL_ACTIVE_ITEM}=\"true\"]`)!;\n\n          if (isHTMLElement(activeEl)) {\n            return {\n              el: activeEl,\n              value: activeEl.getAttribute(CAROUSEL_ITEM)!,\n            };\n          }\n\n          return null;\n        },\n        find(value: string) {\n          if (!treeWalkerRef.current?.currentNode || !htmlRef.current) {\n            return null;\n          }\n\n          treeWalkerRef.current.currentNode = htmlRef.current;\n          let nextNode: Node | null = null;\n          while ((nextNode = treeWalkerRef.current.nextNode())) {\n            if (!isHTMLElement(nextNode)) {\n              continue;\n            }\n\n            if (nextNode.getAttribute(CAROUSEL_ITEM) === value) {\n              return {\n                el: nextNode,\n                value: nextNode.getAttribute(CAROUSEL_ITEM)!,\n              };\n            }\n          }\n\n          return null;\n        },\n        nextPage(value: string) {\n          const res = this.find(value);\n          if (!res || !treeWalkerRef.current?.currentNode) {\n            return null;\n          }\n\n          treeWalkerRef.current.currentNode = res.el;\n          const next = treeWalkerRef.current.nextNode();\n\n          if (isHTMLElement(next)) {\n            return {\n              el: next,\n              value: next.getAttribute(CAROUSEL_ITEM)!,\n            };\n          }\n\n          return null;\n        },\n\n        prevPage(value: string) {\n          const res = this.find(value);\n          if (!res || !treeWalkerRef.current?.currentNode) {\n            return null;\n          }\n\n          treeWalkerRef.current.currentNode = res.el;\n          const next = treeWalkerRef.current.previousNode();\n\n          if (isHTMLElement(next)) {\n            return {\n              el: next,\n              value: next.getAttribute(CAROUSEL_ITEM)!,\n            };\n          }\n\n          return null;\n        },\n      }),\n      [],\n    ),\n  };\n};\n"],"names":["React","isHTMLElement","useFluent_unstable","useFluent","CAROUSEL_ACTIVE_ITEM","CAROUSEL_ITEM","useCarouselWalker_unstable","targetDocument","treeWalkerRef","useRef","createTreeWalker","body","htmlRef","ref","useCallback","el","current","NodeFilter","SHOW_ELEMENT","acceptNode","node","FILTER_SKIP","hasAttribute","FILTER_ACCEPT","walker","useMemo","active","activeEl","querySelector","value","getAttribute","find","currentNode","nextNode","nextPage","res","next","prevPage","previousNode"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}