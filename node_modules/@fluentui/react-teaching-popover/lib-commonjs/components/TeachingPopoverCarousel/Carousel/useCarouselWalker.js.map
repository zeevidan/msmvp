{"version":3,"sources":["../src/components/TeachingPopoverCarousel/Carousel/useCarouselWalker.ts"],"sourcesContent":["import * as React from 'react';\nimport { isHTMLElement } from '@fluentui/react-utilities';\nimport { useFluent_unstable as useFluent } from '@fluentui/react-shared-contexts';\n\nimport { CAROUSEL_ACTIVE_ITEM, CAROUSEL_ITEM } from './constants';\n\nexport type CarouselWalker = {\n  find(value: string): { el: HTMLElement; value: string } | null;\n  nextPage(value: string): { el: HTMLElement; value: string } | null;\n  prevPage(value: string): { el: HTMLElement; value: string } | null;\n  active(): { el: HTMLElement; value: string } | null;\n};\n\nexport const useCarouselWalker_unstable = () => {\n  const { targetDocument } = useFluent();\n\n  const treeWalkerRef = React.useRef<TreeWalker | undefined>(targetDocument?.createTreeWalker(targetDocument.body));\n  const htmlRef = React.useRef<HTMLDivElement | null>(null);\n\n  const ref = React.useCallback(\n    (el: HTMLDivElement | null) => {\n      if (!targetDocument) {\n        return;\n      }\n\n      if (!el) {\n        return;\n      }\n\n      htmlRef.current = el;\n      treeWalkerRef.current = targetDocument.createTreeWalker(el, NodeFilter.SHOW_ELEMENT, {\n        acceptNode(node) {\n          if (!isHTMLElement(node)) {\n            return NodeFilter.FILTER_SKIP;\n          }\n\n          return node.hasAttribute(CAROUSEL_ITEM) ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_SKIP;\n        },\n      });\n    },\n    [targetDocument],\n  );\n\n  return {\n    ref,\n    walker: React.useMemo<CarouselWalker>(\n      () => ({\n        active() {\n          if (!htmlRef.current) {\n            return null;\n          }\n\n          const activeEl = htmlRef.current.querySelector(`[${CAROUSEL_ACTIVE_ITEM}=\"true\"]`)!;\n\n          if (isHTMLElement(activeEl)) {\n            return {\n              el: activeEl,\n              value: activeEl.getAttribute(CAROUSEL_ITEM)!,\n            };\n          }\n\n          return null;\n        },\n        find(value: string) {\n          if (!treeWalkerRef.current?.currentNode || !htmlRef.current) {\n            return null;\n          }\n\n          treeWalkerRef.current.currentNode = htmlRef.current;\n          let nextNode: Node | null = null;\n          while ((nextNode = treeWalkerRef.current.nextNode())) {\n            if (!isHTMLElement(nextNode)) {\n              continue;\n            }\n\n            if (nextNode.getAttribute(CAROUSEL_ITEM) === value) {\n              return {\n                el: nextNode,\n                value: nextNode.getAttribute(CAROUSEL_ITEM)!,\n              };\n            }\n          }\n\n          return null;\n        },\n        nextPage(value: string) {\n          const res = this.find(value);\n          if (!res || !treeWalkerRef.current?.currentNode) {\n            return null;\n          }\n\n          treeWalkerRef.current.currentNode = res.el;\n          const next = treeWalkerRef.current.nextNode();\n\n          if (isHTMLElement(next)) {\n            return {\n              el: next,\n              value: next.getAttribute(CAROUSEL_ITEM)!,\n            };\n          }\n\n          return null;\n        },\n\n        prevPage(value: string) {\n          const res = this.find(value);\n          if (!res || !treeWalkerRef.current?.currentNode) {\n            return null;\n          }\n\n          treeWalkerRef.current.currentNode = res.el;\n          const next = treeWalkerRef.current.previousNode();\n\n          if (isHTMLElement(next)) {\n            return {\n              el: next,\n              value: next.getAttribute(CAROUSEL_ITEM)!,\n            };\n          }\n\n          return null;\n        },\n      }),\n      [],\n    ),\n  };\n};\n"],"names":["useCarouselWalker_unstable","targetDocument","useFluent","treeWalkerRef","React","useRef","createTreeWalker","body","htmlRef","ref","useCallback","el","current","NodeFilter","SHOW_ELEMENT","acceptNode","node","isHTMLElement","FILTER_SKIP","hasAttribute","CAROUSEL_ITEM","FILTER_ACCEPT","walker","useMemo","active","activeEl","querySelector","CAROUSEL_ACTIVE_ITEM","value","getAttribute","find","currentNode","nextNode","nextPage","res","next","prevPage","previousNode"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}