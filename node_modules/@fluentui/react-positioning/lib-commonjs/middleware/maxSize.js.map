{"version":3,"sources":["../src/middleware/maxSize.ts"],"sourcesContent":["import { size } from '@floating-ui/dom';\nimport type { Middleware } from '@floating-ui/dom';\nimport type { NormalizedAutoSize, PositioningOptions } from '../types';\nimport { getBoundary } from '../utils/getBoundary';\nimport { toFloatingUIPadding } from '../utils';\nexport interface MaxSizeMiddlewareOptions\n  extends Pick<PositioningOptions, 'overflowBoundary' | 'overflowBoundaryPadding'> {\n  container: HTMLElement | null;\n  isRtl: boolean;\n}\n\n/**\n * floating-ui `size` middleware uses floating element's height/width to calculate available height/width.\n * This middleware only runs once per lifecycle, resetting styles applied by maxSize from previous lifecycle.\n * Then floating element's original size is restored and `size` middleware can calculate available height/width correctly.\n */\nexport const resetMaxSize = (autoSize: NormalizedAutoSize): Middleware => ({\n  name: 'resetMaxSize',\n  fn({ middlewareData, elements }) {\n    if (middlewareData.resetMaxSize?.maxSizeAlreadyReset) {\n      return {};\n    }\n\n    const { applyMaxWidth, applyMaxHeight } = autoSize;\n    if (applyMaxWidth) {\n      elements.floating.style.removeProperty('box-sizing');\n      elements.floating.style.removeProperty('max-width');\n      elements.floating.style.removeProperty('width');\n    }\n    if (applyMaxHeight) {\n      elements.floating.style.removeProperty('box-sizing');\n      elements.floating.style.removeProperty('max-height');\n      elements.floating.style.removeProperty('height');\n    }\n\n    return {\n      data: { maxSizeAlreadyReset: true },\n      reset: { rects: true },\n    };\n  },\n});\n\nexport function maxSize(autoSize: NormalizedAutoSize, options: MaxSizeMiddlewareOptions): Middleware {\n  const { container, overflowBoundary, overflowBoundaryPadding, isRtl } = options;\n  return size({\n    ...(overflowBoundaryPadding && { padding: toFloatingUIPadding(overflowBoundaryPadding, isRtl) }),\n    ...(overflowBoundary && { altBoundary: true, boundary: getBoundary(container, overflowBoundary) }),\n    apply({ availableHeight, availableWidth, elements, rects }) {\n      const applyMaxSizeStyles = (apply: boolean, dimension: 'width' | 'height', availableSize: number) => {\n        if (!apply) {\n          return;\n        }\n\n        elements.floating.style.setProperty('box-sizing', 'border-box');\n        elements.floating.style.setProperty(`max-${dimension}`, `${availableSize}px`);\n\n        if (rects.floating[dimension] > availableSize) {\n          elements.floating.style.setProperty(dimension, `${availableSize}px`);\n\n          const axis = dimension === 'width' ? 'x' : 'y';\n          if (!elements.floating.style.getPropertyValue(`overflow-${axis}`)) {\n            elements.floating.style.setProperty(`overflow-${axis}`, 'auto');\n          }\n        }\n      };\n\n      const { applyMaxWidth, applyMaxHeight } = autoSize;\n      applyMaxSizeStyles(applyMaxWidth, 'width', availableWidth);\n      applyMaxSizeStyles(applyMaxHeight, 'height', availableHeight);\n    },\n  });\n}\n"],"names":["maxSize","resetMaxSize","autoSize","name","fn","middlewareData","elements","maxSizeAlreadyReset","applyMaxWidth","applyMaxHeight","floating","style","removeProperty","data","reset","rects","options","container","overflowBoundary","overflowBoundaryPadding","isRtl","size","padding","toFloatingUIPadding","altBoundary","boundary","getBoundary","apply","availableHeight","availableWidth","applyMaxSizeStyles","dimension","availableSize","setProperty","axis","getPropertyValue"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;;;;;;;;IA0CgBA,OAAO;eAAPA;;IA1BHC,YAAY;eAAZA;;;qBAhBQ;6BAGO;uBACQ;AAY7B,MAAMA,eAAe,CAACC,WAA8C,CAAA;QACzEC,MAAM;QACNC,IAAG,EAAEC,cAAc,EAAEC,QAAQ,EAAE;gBACzBD;YAAJ,KAAIA,+BAAAA,eAAeJ,YAAY,cAA3BI,mDAAAA,6BAA6BE,mBAAmB,EAAE;gBACpD,OAAO,CAAC;YACV;YAEA,MAAM,EAAEC,aAAa,EAAEC,cAAc,EAAE,GAAGP;YAC1C,IAAIM,eAAe;gBACjBF,SAASI,QAAQ,CAACC,KAAK,CAACC,cAAc,CAAC;gBACvCN,SAASI,QAAQ,CAACC,KAAK,CAACC,cAAc,CAAC;gBACvCN,SAASI,QAAQ,CAACC,KAAK,CAACC,cAAc,CAAC;YACzC;YACA,IAAIH,gBAAgB;gBAClBH,SAASI,QAAQ,CAACC,KAAK,CAACC,cAAc,CAAC;gBACvCN,SAASI,QAAQ,CAACC,KAAK,CAACC,cAAc,CAAC;gBACvCN,SAASI,QAAQ,CAACC,KAAK,CAACC,cAAc,CAAC;YACzC;YAEA,OAAO;gBACLC,MAAM;oBAAEN,qBAAqB;gBAAK;gBAClCO,OAAO;oBAAEC,OAAO;gBAAK;YACvB;QACF;IACF,CAAA;AAEO,SAASf,QAAQE,QAA4B,EAAEc,OAAiC;IACrF,MAAM,EAAEC,SAAS,EAAEC,gBAAgB,EAAEC,uBAAuB,EAAEC,KAAK,EAAE,GAAGJ;IACxE,OAAOK,IAAAA,SAAI,EAAC;QACV,GAAIF,2BAA2B;YAAEG,SAASC,IAAAA,0BAAmB,EAACJ,yBAAyBC;QAAO,CAAC;QAC/F,GAAIF,oBAAoB;YAAEM,aAAa;YAAMC,UAAUC,IAAAA,wBAAW,EAACT,WAAWC;QAAkB,CAAC;QACjGS,OAAM,EAAEC,eAAe,EAAEC,cAAc,EAAEvB,QAAQ,EAAES,KAAK,EAAE;YACxD,MAAMe,qBAAqB,CAACH,OAAgBI,WAA+BC;gBACzE,IAAI,CAACL,OAAO;oBACV;gBACF;gBAEArB,SAASI,QAAQ,CAACC,KAAK,CAACsB,WAAW,CAAC,cAAc;gBAClD3B,SAASI,QAAQ,CAACC,KAAK,CAACsB,WAAW,CAAC,CAAC,IAAI,EAAEF,UAAU,CAAC,EAAE,CAAC,EAAEC,cAAc,EAAE,CAAC;gBAE5E,IAAIjB,MAAML,QAAQ,CAACqB,UAAU,GAAGC,eAAe;oBAC7C1B,SAASI,QAAQ,CAACC,KAAK,CAACsB,WAAW,CAACF,WAAW,CAAC,EAAEC,cAAc,EAAE,CAAC;oBAEnE,MAAME,OAAOH,cAAc,UAAU,MAAM;oBAC3C,IAAI,CAACzB,SAASI,QAAQ,CAACC,KAAK,CAACwB,gBAAgB,CAAC,CAAC,SAAS,EAAED,KAAK,CAAC,GAAG;wBACjE5B,SAASI,QAAQ,CAACC,KAAK,CAACsB,WAAW,CAAC,CAAC,SAAS,EAAEC,KAAK,CAAC,EAAE;oBAC1D;gBACF;YACF;YAEA,MAAM,EAAE1B,aAAa,EAAEC,cAAc,EAAE,GAAGP;YAC1C4B,mBAAmBtB,eAAe,SAASqB;YAC3CC,mBAAmBrB,gBAAgB,UAAUmB;QAC/C;IACF;AACF"}